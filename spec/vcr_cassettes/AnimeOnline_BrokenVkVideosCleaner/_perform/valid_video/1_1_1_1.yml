---
http_interactions:
- request:
    method: get
    uri: https://api.vk.com/method/video.get?access_token=USER_ACCESS_TOKEN_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&v=5.73&videos=-102087446_456241218
    body:
      encoding: US-ASCII
      string: ''
    headers:
      User-Agent:
      - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML,
        like Gecko) Chrome/39.0.2171.71 Safari/537.36
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - Internet Information Services
      Date:
      - Wed, 29 Aug 2018 16:39:41 GMT
      Content-Type:
      - application/json; charset=utf-8
      Content-Length:
      - '674'
      Connection:
      - keep-alive
      X-Powered-By:
      - PHP/3.16479
      Cache-Control:
      - no-store
    body:
      encoding: ASCII-8BIT
      string: !binary |-
        eyJyZXNwb25zZSI6eyJjb3VudCI6MSwiaXRlbXMiOlt7ImlkIjo0NTYyNDEyMTgsIm93bmVyX2lkIjotMTAyMDg3NDQ2LCJ0aXRsZSI6ImFuaW1lLndlYm0g0K3RgtC+INC30L3QsNGC0Ywg0L3QsNC00L4hINCt0YLQviDQutC70LDRgdGB0LjQutCwISIsImR1cmF0aW9uIjo0LCJkZXNjcmlwdGlvbiI6IvCflKXQldCp0JUg0JHQntCb0KzQqNCVINCT0J7QlNCd0J7QotCrINCX0JTQldCh0Kzwn5SlXG5cblB1YmxpY/CfkYkgdmsuY29tXC9hbmltZXdlYm1cbllvdVR1YmXwn5GJIHlvdXR1YmUuY29tXC9jXC9BbmltZVdlYk1PZmZpY2lhbFxuVGVsZWdyYW3wn5GJIHQubWVcL2FuaW1ld2VibXBsYXRpbnVtIiwiZGF0ZSI6MTQ3OTIxMjE0NSwiY29tbWVudHMiOjMwMywidmlld3MiOjk3MDE2MSwid2lkdGgiOjg1NCwiaGVpZ2h0Ijo0ODAsInBob3RvXzEzMCI6Imh0dHBzOlwvXC9wcC51c2VyYXBpLmNvbVwvYzYzODkyMVwvdjYzODkyMTQ0NlwvY2MyN1wvc0FwbjlXUVF6MFUuanBnIiwicGhvdG9fMzIwIjoiaHR0cHM6XC9cL3BwLnVzZXJhcGkuY29tXC9jNjM4OTIxXC92NjM4OTIxNDQ2XC9jYzI1XC92ZGktRk5BbEQway5qcGciLCJwaG90b184MDAiOiJodHRwczpcL1wvcHAudXNlcmFwaS5jb21cL2M2Mzg5MjFcL3Y2Mzg5MjE0NDZcL2NjMjRcL2EzMTlERDdJUUpBLmpwZyIsInJlcGVhdCI6MSwiZmlyc3RfZnJhbWVfMzIwIjoiaHR0cHM6XC9cL3BwLnVzZXJhcGkuY29tXC9jNjM4MDIyXC92NjM4MDIyNDQ2XC9hZmM2XC9ETFhuNFREc05wWS5qcGciLCJmaXJzdF9mcmFtZV8xNjAiOiJodHRwczpcL1wvcHAudXNlcmFwaS5jb21cL2M2MzgwMjJcL3Y2MzgwMjI0NDZcL2FmYzdcL1ZkcXBUNDFNTUNNLmpwZyIsImZpcnN0X2ZyYW1lXzEzMCI6Imh0dHBzOlwvXC9wcC51c2VyYXBpLmNvbVwvYzYzODAyMlwvdjYzODAyMjQ0NlwvYWZjOFwvcHI5TUhGZnAyTjQuanBnIiwiZmlyc3RfZnJhbWVfODAwIjoiaHR0cHM6XC9cL3BwLnVzZXJhcGkuY29tXC9jNjM4MDIyXC92NjM4MDIyNDQ2XC9hZmM1XC81b1RCWDFkTGRKdy5qcGciLCJwbGF5ZXIiOiJodHRwczpcL1wvdmsuY29tXC92aWRlb19leHQucGhwP29pZD0tMTAyMDg3NDQ2JmlkPTQ1NjI0MTIxOCZoYXNoPWE4ZTkzNWYyMjQzNzc0MGImX19yZWY9dmsuYXBpJmFwaV9oYXNoPTE1MzU1NjA3ODFkNzExNWE2NzAwYTY3NTExMzlfR0VaVE1PQlZHSVpUUyIsImNhbl9hZGQiOjF9XX19
    http_version: 
  recorded_at: Wed, 29 Aug 2018 16:39:32 GMT
- request:
    method: get
    uri: http://vk.com/video_ext.php?hash=a8e935f22437740b&id=456241218&oid=-102087446
    body:
      encoding: US-ASCII
      string: ''
    headers:
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 302
      message: Found
    headers:
      Server:
      - Internet Information Services
      Date:
      - Wed, 29 Aug 2018 16:39:41 GMT
      Content-Type:
      - text/html; charset=windows-1251
      Content-Length:
      - '20'
      Connection:
      - keep-alive
      X-Powered-By:
      - PHP/3.16479
      Set-Cookie:
      - remixlang=0; expires=Mon, 19 Aug 2019 22:50:46 GMT; path=/; domain=.vk.com
      Cache-Control:
      - no-store
      Location:
      - https://vk.com/video_ext.php?oid=-102087446&id=456241218&hash=a8e935f22437740b
      X-Frontend:
      - front504216
      Access-Control-Expose-Headers:
      - X-Frontend
    body:
      encoding: ASCII-8BIT
      string: ''
    http_version: 
  recorded_at: Wed, 29 Aug 2018 16:39:32 GMT
- request:
    method: get
    uri: https://vk.com/video_ext.php?hash=a8e935f22437740b&id=456241218&oid=-102087446
    body:
      encoding: US-ASCII
      string: ''
    headers:
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - Internet Information Services
      Date:
      - Wed, 29 Aug 2018 16:39:41 GMT
      Content-Type:
      - text/html; charset=windows-1251
      Content-Length:
      - '3929'
      Connection:
      - keep-alive
      X-Powered-By:
      - PHP/3.16479
      Set-Cookie:
      - remixlang=0; expires=Thu, 29 Aug 2019 00:57:50 GMT; path=/; domain=.vk.com
      Cache-Control:
      - no-store
      Strict-Transport-Security:
      - max-age=15768000
      X-Frontend:
      - front504214
      Access-Control-Expose-Headers:
      - X-Frontend
    body:
      encoding: ASCII-8BIT
      string: !binary |-
        PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjAgU3RyaWN0Ly9FTiIgImh0dHA6Ly93d3cudzMub3JnL1RSL3hodG1sMS9EVEQveGh0bWwxLXN0cmljdC5kdGQiPgo8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgeG1sOmxhbmc9ImVuIiBsYW5nPSJlbiI+Cgo8aGVhZD4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iL2pzL2xvYWRlcl9uYXY3MjU0Mjg2MzQ2MDgxXzAuanMiPjwvc2NyaXB0PgoKPGxpbmsgcmVsPSJzaG9ydGN1dCBpY29uIiBocmVmPSIvaW1hZ2VzL2ljb25zL2Zhdmljb25zL2Zhdl9sb2dvLmljbz82IiAvPgoKPG1ldGEgaHR0cC1lcXVpdj0iY29udGVudC10eXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9d2luZG93cy0xMjUxIiAvPgo8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiIC8+CjxtZXRhIG5hbWU9InJvYm90cyIgY29udGVudD0ibm9pbmRleCwgbm9mb2xsb3ciIC8+Cgo8dGl0bGU+wsru7fLg6vLlIHwgVmlkZW8gRXh0PC90aXRsZT4KCjxub3NjcmlwdD48bWV0YSBodHRwLWVxdWl2PSJyZWZyZXNoIiBjb250ZW50PSIwOyBVUkw9L2JhZGJyb3dzZXIucGhwIj48L25vc2NyaXB0PgoKPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iL2Nzcy9hbC9mb250c19jbnQuY3NzPzEzMTg2NTA4MjMiIC8+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii9jc3MvYWwvbGl0ZS5jc3M/NTMzNjY1OTEyODYiIC8+Cgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CnZhciB2ayA9IHsKICBhZHNfcm90YXRlX2ludGVydmFsOiAxMjAwMDAsCiAgYWw6IHBhcnNlSW50KCc0JykgfHwgNCwKICBpbnRuYXQ6ICcxJyA/IHRydWUgOiBmYWxzZSwKICBsYW5nOiAwLAogIHJ0bDogcGFyc2VJbnQoJycpIHx8IDAsCiAgdmVyc2lvbjogNzI1NDI4NjM0NjA4MSwKICBsb2dpbnNjaGVtZTogJ2h0dHBzJywKICBpcF9oOiAnMGRkNGRmNThmMjljMWY0YWNlJywKICBpZDogcGFyc2VJbnQoJzAnKSwKICBub2RvbWFpbjogJycsCiAgcHJfdHBsOiAiPGRpdiBjbGFzcz1cInByICVjbHMlXCIgaWQ9XCIlaWQlXCI+PGRpdiBjbGFzcz1cInByX2J0XCI+PFwvZGl2PjxkaXYgY2xhc3M9XCJwcl9idFwiPjxcL2Rpdj48ZGl2IGNsYXNzPVwicHJfYnRcIj48XC9kaXY+PFwvZGl2PiIsCiAgYXVkaW9JbmxpbmVQbGF5ZXJUcGw6ICI8ZGl2IGNsYXNzPVwiYXVkaW9faW5saW5lX3BsYXllciBfYXVkaW9faW5saW5lX3BsYXllciBub19zZWxlY3RcIj5cbiAgPGRpdiBjbGFzcz1cImF1ZGlvX2lubGluZV9wbGF5ZXJfcmlnaHRcIj5cbiAgICA8ZGl2IGNsYXNzPVwiYXVkaW9faW5saW5lX3BsYXllcl92b2x1bWVcIj48XC9kaXY+XG4gIDxcL2Rpdj5cbiAgPGRpdiBjbGFzcz1cImF1ZGlvX2lubGluZV9wbGF5ZXJfbGVmdFwiPlxuICAgIDxkaXYgY2xhc3M9XCJhdWRpb19pbmxpbmVfcGxheWVyX3Byb2dyZXNzXCI+PFwvZGl2PlxuICA8XC9kaXY+XG48XC9kaXY+IiwKICB3aWRnZXQ6IDEsCiAgc2hvd19leHRlcm5hbF9hdXRoX2JveDogMCwKICBjc3NfZGlyOiAnJwp9CnZhciBTdGF0aWNGaWxlcyA9IHsKICAnbGl0ZS5qcyc6e3Y6MzQ0NDQ4MTI2fSwKICAnbGl0ZS5jc3MnOnt2OjUzMzY2NTkxMjg2fSwnZm9udHNfY250LmNzcyc6e3Y6MTMxODY1MDgyM30sJ2xhbmcwXzAuanMnOiB7djogMjU1OTI2Nzl9Cn0KPC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii9qcy9hbC9saXRlLmpzPzM0NDQ0ODEyNiI+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii9qcy9sYW5nMF8wLmpzPzI1NTkyNjc5Ij48L3NjcmlwdD48YmFzZSB0YXJnZXQ9Il9ibGFuayIvPgoKPC9oZWFkPgoKPGJvZHkgc3R5bGU9ImJhY2tncm91bmQ6ICMwMDA7IGhlaWdodDogMTAwJTsiIGNsYXNzPSJpc19ydGwgVksxICB3aWRnZXRfYm9keSBub2ZpeGVkIG5vX2F1dGgiPgogIDxkaXYgaWQ9InN5c3RlbV9tc2ciIGNsYXNzPSJmaXhlZCI+PC9kaXY+CiAgPGRpdiBpZD0idXRpbHMiPjwvZGl2PgogIDxkaXYgaWQ9ImJveF9sYXllcl9iZyIgY2xhc3M9ImZpeGVkIj48L2Rpdj48ZGl2IGlkPSJib3hfbGF5ZXJfd3JhcCIgY2xhc3M9InNjcm9sbF9maXhfd3JhcCBmaXhlZCI+PGRpdiBpZD0iYm94X2xheWVyIj48ZGl2IGlkPSJib3hfbG9hZGVyIj48ZGl2IGNsYXNzPSJwciBwcl9iYXcgcHJfbWVkaXVtIiBpZD0iYm94X2xvYWRlcl9wciI+PGRpdiBjbGFzcz0icHJfYnQiPjwvZGl2PjxkaXYgY2xhc3M9InByX2J0Ij48L2Rpdj48ZGl2IGNsYXNzPSJwcl9idCI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0iYmFjayI+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+CgogIDxkaXYgaWQ9InN0bF9sZWZ0Ij48L2Rpdj48ZGl2IGlkPSJzdGxfc2lkZSI+PC9kaXY+CgogIDxhIGlkPSJ3aWRnZXRfZm9jdXNfbGluayIgaHJlZj0iamF2YXNjcmlwdDogcmV0dXJuOyI+PC9hPgogIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5kb21TdGFydGVkKCk7PC9zY3JpcHQ+CgogIDxkaXYgaWQ9InBhZ2Vfd3JhcCI+PGRpdiBpZD0idmlkZW9fYm94X3dyYXAtMTAyMDg3NDQ2XzQ1NjI0MTIxOCIgY2xhc3M9InZpZGVvX2JveF93cmFwIj4KICA8ZGl2IGlkPSJ2aWRlb19ib3hfbW9iaWxlX3RodW1iIiBjbGFzcz0idmlkZW9fYm94X21vYmlsZV90aHVtYiB1bnNob3duIiBzdHlsZT0iYmFja2dyb3VuZC1pbWFnZTp1cmwoaHR0cHM6Ly9wcC51c2VyYXBpLmNvbS9jNjM4OTIxL3Y2Mzg5MjE0NDYvY2MyNC9hMzE5REQ3SVFKQS5qcGcpOyI+PC9kaXY+CiAgPHZpZGVvIGlkPSJ2aWRlb19wbGF5ZXIiIHBvc3Rlcj0iaHR0cHM6Ly9wcC51c2VyYXBpLmNvbS9jNjM4OTIxL3Y2Mzg5MjE0NDYvY2MyNC9hMzE5REQ3SVFKQS5qcGciIHByZWxvYWQ9Im5vbmUiIGNvbnRyb2xzICBvbnBsYXlpbmc9ImN1ci5pbmNWaWV3cyAmJiBjdXIuaW5jVmlld3MoKSIgZGF0YS1kdXJhdGlvbj0iNCI+CiAgICA8c291cmNlIHNyYz0iaHR0cHM6Ly92ay5jb20vdmlkZW9faGxzLnBocD9kaXJzJTVCNDgwJTVEPWh0dHBzJTNBJTJGJTJGY3M1MTE0MDUudmt1c2VydmlkZW8ubmV0JTJGNyUyRnU5NTU5MDMyNiUyRnZpZGVvcyUyRiZhbXA7cGF0aD03JTJGdTk1NTkwMzI2JTJGdmlkZW9zJTJGJmFtcDtleHRyYT1FRTdTUklpa1IwN0pVa20xS0I1S1VqWll2MDZLMkk5TW8zbTcyd3g3OVBNTEJqTkc2RDBRQVRRWWtZTGFJYlJDTVhKR0NIdnJPWk4yV0dxc3RqbnRPZ05XVktMclRSZjNMM3RlS0w3OEpJbmltMGFDS2F2azFHN21aM2tmNUstRiZhbXA7Y19leHRyYT1mUWZjaWNVRDk3TnhPM2pPNm5QZzVwZTNPTHo4SzlBUmQzNXhTMEJtQmR5eDZRT3U3LXBlVGs5aXo2RlgwYU1QSkdSRnlTR2MtVzZxcktiZ2FFWGY1VWFhTnJkNDhlWmZ0a1hlUjFIQU5XaDdfWmM4Vk00Z2JFcy1oN3NqcXM1TCZhbXA7dmlkZW89LTEwMjA4NzQ0Nl80NTYyNDEyMTgmYW1wO3RhZz03ZjMzOTlkNzg0JmFtcDtjX3RhZz1mODZiYWRjN2Y1MjQmYW1wO2hhc2g9YzM4MTk3OTQwYTk5MzQ4ZjE0IiB0eXBlPSJhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3VybCIgLz48c291cmNlIHNyYz0iaHR0cHM6Ly9jczEtNzd2NC52a3VzZXJ2aWRlby5uZXQvcDIzL2Y4NmJhZGM3ZjUyNC40ODAubXA0P2V4dHJhPWRNSU44OERfdlR6Q0hOSGx2TG95aDBJM3RobjNBQllQUExJU05OS2VzcG5VUDJTOFhWanQ2VWlGLUlZMmV6cnllRzFDX01scE9GOHg5QkVRNEIxRVJtdHJ2ajFWUlhudU5Id0ZPLVp5eWpDc3lJQkxPaUY1czJ6YWlCbEk2Ri1uIiB0eXBlPSJ2aWRlby9tcDQiIC8+PHNvdXJjZSBzcmM9Imh0dHBzOi8vY3MxLTY2djQudmt1c2VydmlkZW8ubmV0L3AyMC9mODZiYWRjN2Y1MjQuMzYwLm1wND9leHRyYT1rVFYtTjJBNjFOUHVEQmxHbnBmSWpWcEh5ekdmRFFTeEFacFhXQ2xEQkF2UVZ2RnJuNWZ2dTNHdXdBYTluSkJuZnZWVmx4UXFaSzhHLS1aOGZfSzhKTzVIcWJocGh0VlFmbU1FQUl0dkQ2SGNfNWt3aW1SUVVaNi1FMEMzQWlWNyIgdHlwZT0idmlkZW8vbXA0IiAvPjxzb3VyY2Ugc3JjPSJodHRwczovL2NzMS02OHY0LnZrdXNlcnZpZGVvLm5ldC9wMTIvZjg2YmFkYzdmNTI0LjI0MC5tcDQ/ZXh0cmE9eVFOaTYwVjAxTkEydWl6NGl3MXhQRXdSQ212dVBRRkx0OWMzcVVTclVMZTdMd1BQeXZBaVFBN2k4eFRvc3hKX3AxczB6cGgwcTBWcV9KcmVySHBYeGdHZW42YW5rMldGQjRpTWxXR1REYXQxMkR5R3JJRUp1UHZ4SE45SUpOcXUiIHR5cGU9InZpZGVvL21wNCIgLz4KICAgIDxkaXYgY2xhc3M9InZpZGVvX2JveF9iYWNrZ3JvdW5kIiBzdHlsZT0iYmFja2dyb3VuZC1pbWFnZTp1cmwoaHR0cHM6Ly9wcC51c2VyYXBpLmNvbS9jNjM4OTIxL3Y2Mzg5MjE0NDYvY2MyNC9hMzE5REQ3SVFKQS5qcGcpOyI+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJ2aWRlb19ib3hfY2FudF9wbGF5Ij7E4O3t7uUg4ujk5e4g7eUg7O7m5fIg4fvy/CDv8O7o4/Dg7e4g7eAg/fLu7CDz8fLw7unx8uLlPC9kaXY+CiAgPC92aWRlbz4KPC9kaXY+PC9kaXY+CiAgPGRpdiBjbGFzcz0icHJvZ3Jlc3MiIGlkPSJnbG9iYWxfcHJnIj48L2Rpdj4KCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAgaWYgKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID49IDIpIHsKICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc05hbWUgKz0gJyBpc18yeCc7CiAgICB9CiAgICBkb21SZWFkeSgpOwogICAgCmFkZExhbmdLZXlzKHsiZ2xvYmFsX2Vtb2ppX2NhdF9yZWNlbnQiOiLX4PHy7iDo8e/u6/zn8+Xs++UiLCJnbG9iYWxfZW1vamlfY2F0XzEiOiLd7O726OgiLCJnbG9iYWxfZW1vamlfY2F0XzIiOiLG6OLu8u375SDoIPDg8fLl7ej/IiwiZ2xvYmFsX2Vtb2ppX2NhdF8zIjoixuXx8vsg6CDr/uToIiwiZ2xvYmFsX2Vtb2ppX2NhdF80IjoixeTgIOgg7eDv6PLq6CIsImdsb2JhbF9lbW9qaV9jYXRfNSI6ItHv7vDyIOgg4Ory6OLt7vHy6CIsImdsb2JhbF9lbW9qaV9jYXRfNiI6Is/z8uX45fHy4uj/IOgg8vDg7fHv7vDyIiwiZ2xvYmFsX2Vtb2ppX2NhdF83Ijoiz/Dl5Ozl8vsiLCJnbG9iYWxfZW1vamlfY2F0XzgiOiLR6Ozi7uv7IiwiZ2xvYmFsX2Vtb2ppX2NhdF85Ijoi1Ovg4+gifSwgdHJ1ZSk7CmFkZFRlbXBsYXRlcyh7Il8iOiJfIn0pOwpleHRlbmQoY3VyLCB7CiAgdmlkZW9QbGF5ZXI6IGdlQnlUYWcxKCd2aWRlbycpLAogIHZpZGVvQ2hlY2tQbGF5YmFjazogZnVuY3Rpb24ocGF1c2VkKSB7CiAgICB2YXIgdGltZSA9IGN1ci52aWRlb1RpbWUgKyAoY3VyLnZpZGVvU3RhcnQgPyB2a05vdygpIC0gY3VyLnZpZGVvU3RhcnQgOiAwKTsKICAgIGlmICh0aW1lID4gNTAwMCkgewogICAgICBpZiAoY3VyLnZpZGVvU2hvd24pIHJldHVybjsKICAgICAgYWpheC5wb3N0KCcvYWxfdmlkZW8ucGhwP2FjdD1pbmNfdmlld19jb3VudGVyJmVtYmVkPTEmbW9kdWxlPWVtYmVkJmhhc2g9ZjgxY2NjNzdiZGQwNjEwOTQ3M2U5MzZmYjM0NjJkZjUmb2lkPS0xMDIwODc0NDYmdmlkPTQ1NjI0MTIxOCZ5dj0wJywge19hamF4OiAxfSk7CiAgICAgIGN1ci52aWRlb1Nob3duID0gdHJ1ZTsKICAgIH0KICAgIGNsZWFyVGltZW91dChjdXIudmlkZW9Ubyk7CiAgICBpZiAoIXBhdXNlZCkgewogICAgICBjdXIudmlkZW9UbyA9IHNldFRpbWVvdXQoY3VyLnZpZGVvQ2hlY2tQbGF5YmFjaywgMTAwMCk7CiAgICB9CiAgfSwKICBvblZpZGVvUGxheTogZnVuY3Rpb24oKSB7CiAgICBpZiAoIWN1ci52aWRlb1N0YXJ0ZWQpIHsKICAgICAgYWpheC5wb3N0KCcvYWxfdmlkZW8ucGhwP2FjdD12aWRlb192aWV3X3N0YXJ0ZWQmZW1iZWQ9MSZtb2R1bGU9ZW1iZWQmaGFzaD1mODFjY2M3N2JkZDA2MTA5NDczZTkzNmZiMzQ2MmRmNSZvaWQ9LTEwMjA4NzQ0NiZ2aWQ9NDU2MjQxMjE4Jnl2PTAnLCB7X2FqYXg6IDF9KTsKICAgICAgY3VyLnZpZGVvU3RhcnRlZCA9IHRydWU7CiAgICB9CiAgICBjdXIudmlkZW9TdGFydCA9IHZrTm93KCk7CiAgICBjdXIudmlkZW9DaGVja1BsYXliYWNrICYmIGN1ci52aWRlb0NoZWNrUGxheWJhY2soKTsKICB9LAogIG9uVmlkZW9QYXVzZTogZnVuY3Rpb24oKSB7CiAgICBjdXIudmlkZW9UaW1lID0gdmtOb3coKSAtIGN1ci52aWRlb1N0YXJ0OwogICAgY3VyLnZpZGVvU3RhcnQgPSAwOwogICAgY3VyLnZpZGVvQ2hlY2tQbGF5YmFjayAmJiBjdXIudmlkZW9DaGVja1BsYXliYWNrKHRydWUpOwogIH0sCiAgdmlkZW9TdGFydGVkOiBmYWxzZSwKICB2aWRlb1Nob3duOiBmYWxzZSwKICB2aWRlb1N0YXJ0OiAwLAogIHZpZGVvVGltZTogMAp9KTsKaWYgKGN1ci52aWRlb1BsYXllcikgewogIGFkZEV2ZW50KGN1ci52aWRlb1BsYXllciwgJ3BsYXknLCBjdXIub25WaWRlb1BsYXkpOwogIGFkZEV2ZW50KGN1ci52aWRlb1BsYXllciwgJ3BhdXNlJywgY3VyLm9uVmlkZW9QYXVzZSk7CiAgY3VyLmRlc3Ryb3kucHVzaChmdW5jdGlvbigpIHsKICAgIHJlbW92ZUV2ZW50KGN1ci52aWRlb1BsYXllciwgJ3BsYXknLCBjdXIub25WaWRlb1BsYXkpOwogICAgcmVtb3ZlRXZlbnQoY3VyLnZpZGVvUGxheWVyLCAncGF1c2UnLCBjdXIub25WaWRlb1BhdXNlKTsKICAgIGNsZWFyVGltZW91dChjdXIudmlkZW9Ubyk7CiAgfSk7Cn13aW5kb3cucmVzb2x1dGlvbiA9IDA7Cgp3aW5kb3cucGxheWVyQ2FsbGJhY2sgPSB7CiAgcmFuZG9tTnVtYmVyOiBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDAwKSwKICBzY29yZUNhcmRDb3VudGVyOiBmdW5jdGlvbiAoKSB7CiAgICAvLyB2a0ltYWdlKCkuc3JjID0gdmsubG9naW5zY2hlbWUgKyAnOi8vYi5zY29yZWNhcmRyZXNlYXJjaC5jb20vcD9jMT0xJmMyPTEzNzY1MjE2JmM1PTA2JnJuPScgKyBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDAwKTsKICB9LAogIG9uVmlkZW9QbGF5UHJvZ3Jlc3M6IGZ1bmN0aW9uKG9pZCwgdmlkLCBoYXNoLCB0aW1lX3Byb2dyZXNzLCB0aW1lX3RvdGFsKSB7CiAgICB2YXIgcmF3SWQgPSBvaWQrJ18nK3ZpZDsKICAgIGlmICh0aW1lX3Byb2dyZXNzIDwgNTAwMCAmJiB3aW5kb3cudG5zU3RhcnQgIT0gcmF3SWQpIHsKICAgICAgcGxheWVyQ2FsbGJhY2suc2NvcmVDYXJkQ291bnRlcigpOwogICAgICB3aW5kb3cudG5zU3RhcnQgPSByYXdJZDsKICAgIH0gZWxzZSBpZiAodGltZV9wcm9ncmVzcyA+ICh0aW1lX3RvdGFsIC8gMikgJiYgd2luZG93LnRuc0VuZCAhPSByYXdJZCkgewogICAgICB3aW5kb3cudG5zRW5kID0gcmF3SWQ7CiAgICB9CiAgfSwKICBpbmNWaWV3Q291bnRlcjogZnVuY3Rpb24ob2lkLCB2aWQsIGhhc2gsIGN1cnJSZXMsIG1heFJlcywgcGxheWVyLCB0eXBlKSB7CiAgICBhamF4LnBvc3QoJy9hbF92aWRlby5waHAnLCB7CiAgICAgIGFjdDogJ2luY192aWV3X2NvdW50ZXInLAogICAgICBvaWQ6IG9pZCwKICAgICAgdmlkOiB2aWQsCiAgICAgIGhhc2g6IGhhc2gsCiAgICAgIGN1cnJfcmVzOiBjdXJyUmVzLAogICAgICBtYXhfcmVzOiBtYXhSZXMsCiAgICAgIHBsYXllcjogcGxheWVyIHx8ICdmbGFzaCcsCiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGVtYmVkOiAxLAogICAgICB5djogMAogICAgfSwge30pOwogIH0sCiAgcm90YXRlVmlkZW86IGZ1bmN0aW9uKG9pZCwgdmlkLCBhbmdsZSwgaGFzaCkgewogICAgYWpheC5wb3N0KCdhbF92aWRlby5waHAnLCB7CiAgICAgIGFjdDogJ3JvdGF0ZV92aWRlbycsCiAgICAgIG9pZDogb2lkLAogICAgICB2aWQ6IHZpZCwKICAgICAgYW5nbGU6IGFuZ2xlLAogICAgICBoYXNoOiBoYXNoCiAgICB9LCB7fSk7CiAgfSwKICBvblZpZGVvUmVzb2x1dGlvbkNoYW5nZWQ6IGZ1bmN0aW9uKG9pZCwgdmlkLCBoYXNoLCByZXNvbHV0aW9uKSB7CiAgICB3aW5kb3cucmVzb2x1dGlvbiA9IHJlc29sdXRpb247CiAgfSwKICBvbkluaXRpYWxpemVkOiBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5pbml0SnNBcGkgJiYgaW5pdEpzQXBpKCk7CiAgfSwKICBvblZpZGVvUGxheVN0YXJ0ZWQ6IGZ1bmN0aW9uKG9pZCwgdmlkLCBoYXNoKSB7CiAgICBhamF4LnBvc3QoJ2FsX3ZpZGVvLnBocCcsIHsKICAgICAgYWN0OiAndmlkZW9fdmlld19zdGFydGVkJywKICAgICAgb2lkOiBvaWQsCiAgICAgIHZpZDogdmlkLAogICAgICBoYXNoOiBoYXNoLAogICAgICBxdWFsaXR5OiB3aW5kb3cucmVzb2x1dGlvbiB8fCAwLAogICAgICBlbWJlZDogMSwKICAgICAgeXY6IDAsCiAgICAgIHBsYXllcl92aWV3X3R5cGU6ICdlbWJlZCcKICAgIH0sIHt9KTsKICB9LAogIG9uVmlkZW9QbGF5RmluaXNoZWQ6IGZ1bmN0aW9uKCkgewogIH0sCiAgb25WaWRlb0Fkc0xvYWRTdGFydGVkOiBmdW5jdGlvbigpIHsKICB9LAogIG9uVmlkZW9BZHNQbGF5U3RhcnRlZDogZnVuY3Rpb24oKSB7CiAgfSwKICBvblZpZGVvQWRzUGxheUZpbmlzaGVkOiBmdW5jdGlvbigpIHsKICB9Cn07CgpmdW5jdGlvbiB2aWRlb0NhbGxiYWNrKHBhcmFtcykgewogIHZhciBtZXRob2QgPSBwYXJhbXMuc2hpZnQoKTsKICBpZiAocGxheWVyQ2FsbGJhY2tbbWV0aG9kXSkgewogICAgcGxheWVyQ2FsbGJhY2tbbWV0aG9kXS5hcHBseShudWxsLCBwYXJhbXMpOwogIH0gZWxzZSBpZiAod2luZG93LlZpZGVvdmlldyAmJiBWaWRlb3ZpZXcucGxheWVyQ2FsbGJhY2tbbWV0aG9kXSkgewogICAgVmlkZW92aWV3LnBsYXllckNhbGxiYWNrW21ldGhvZF0uYXBwbHkoVmlkZW92aWV3LCBwYXJhbXMpOwogIH0gZWxzZSB7CiAgICB0aHJvdyBFcnJvcignVW5yZWdpc3RlcmVkIHBsYXllciBjYWxsYmFjazogJyArIG1ldGhvZCk7CiAgfQp9CgpjdXIubXZPcHRzID0gewogIG9pZDogLTEwMjA4NzQ0NiwKICB2aWQ6IDQ1NjI0MTIxOAp9OzsoZnVuY3Rpb24oKSB7CiAgdmFyIHZpZGVvID0gZ2UoJ3ZpZGVvX3BsYXllcicpOwogIHZhciB0aHVtYiA9IGdlKCd2aWRlb19ib3hfbW9iaWxlX3RodW1iJyk7CiAgaWYgKCF0aHVtYiB8fCAhd2luZG93LkhUTUxWaWRlb0VsZW1lbnQgfHwgISh2aWRlbyBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQpKSByZXR1cm47CgogIGlmICghdmlkZW8uaGFzQXR0cmlidXRlKCdhdXRvcGxheScpKSB7CiAgICByZW1vdmVDbGFzcyh0aHVtYiwgJ3Vuc2hvd24nKTsKICAgIGFkZENsYXNzKHZpZGVvLCAnaGlkZGVuJyk7CiAgICB0aHVtYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICBhZGRDbGFzcyh0aHVtYiwgJ2hpZGRlbicpOwogICAgICByZW1vdmVDbGFzcyh2aWRlbywgJ2hpZGRlbicpOwogICAgICB2aWRlby5wbGF5KCk7CiAgICAgICh2aWRlby5yZXF1ZXN0RnVsbHNjcmVlbiB8fCB2aWRlby53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbiB8fCB2aWRlby53ZWJraXRFbnRlckZ1bGxzY3JlZW4gfHwgZnVuY3Rpb24oKXt9KS5jYWxsKHZpZGVvKTsKICAgIH0pOwogICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigncGxheScsIGZ1bmN0aW9uKCkgewogICAgICBhZGRDbGFzcyh0aHVtYiwgJ2hpZGRlbicpOwogICAgICByZW1vdmVDbGFzcyh2aWRlbywgJ2hpZGRlbicpOwogICAgfSk7CiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAodmlkZW8uZXhpdEZ1bGxzY3JlZW4gfHwgdmlkZW8ud2Via2l0RXhpdEZ1bGxTY3JlZW4gfHwgZnVuY3Rpb24oKXt9KS5jYWxsKHZpZGVvKTsKICAgIH0pOwogIH0KfSkoKTs7dmsuaWQgPSAwCiAgICAKICA8L3NjcmlwdD4KPC9ib2R5PgoKPC9odG1sPg==
    http_version: 
  recorded_at: Wed, 29 Aug 2018 16:39:32 GMT
recorded_with: VCR 4.0.0
