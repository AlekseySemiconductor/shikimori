- cover_by ||= (json? || user_signed_in?) ? :link : :linkeable
- content_by ||= :tooltip
- cover_notice ||= :none
- cover_title ||= :present
- content_title ||= :present
- content_text ||= :present

- tooltipped = content_by == :tooltip || content_by == :mini_tooltip

article.c-column.b-catalog_entry.not-tracked[
  class="c-#{anime.anime? ? :anime : :manga} entry-#{anime.id} #{:tooltipped if content_by == :mini_tooltip} #{:cc if content_by == :block} item-#{anime_counter if defined?(anime_counter) && anime_counter}"
  id="#{anime.id}"
  itemscope itemtype="#{{anime.itemtype}}"
  data-track_user_rate="#{UserRates::Tracker.instance.placeholder :catalog_entry, anime}"
]
  meta[
    itemprop="image"
    content="#{{meta_image_url anime.image, :original, false}}"
  ]
  meta[
    itemprop="thumbnailUrl"
    content="#{{meta_image_url anime.image, :x48, false}}"
  ]

  - if cover_by == :link || cover_by == :image_link
    a.cover[
      class="#{'anime-tooltip' if tooltipped}"
      href="#{anime.url}"
      title="#{anime.name}"
      data-delay="150"
      data-predelay="#{tooltip_predelay if defined? tooltip_predelay}"
      data-insert-tooltip-after="#{content_by == :mini_tooltip}"
      data-relative="#{content_by == :mini_tooltip}"
      data-tooltip_url="#{anime.tooltip_url content_by == :mini_tooltip}"
    ]
      = render partial: 'animes/cover',
        object: anime,
        as: :anime,
        locals: {\
          cover_title: cover_title,
          cover_by: cover_by,
          cover_notice: cover_notice\
        }

  - elsif cover_by == :linkeable
    .cover.linkeable[
      class="#{'anime-tooltip' if tooltipped}"
      data-href="#{anime.url}"
      data-title="#{anime.name}"
      data-delay="150"
      data-insert-tooltip-after="#{content_by == :mini_tooltip}"
      data-relative="#{content_by == :mini_tooltip}"
      data-tooltip_url="#{anime.tooltip_url content_by == :mini_tooltip}"
    ]
      = render partial: 'animes/cover',
        object: anime,
        as: :anime,
        locals: {\
          cover_title: cover_title,
          cover_by: cover_by,
          cover_notice: cover_notice,
        }

  - else
    - raise ArgumentError, cover_by

  - unless tooltipped || content_by == :none
    .content
      - if content_by == :block
        = render 'animes/content',
          anime: anime,
          cover_by: cover_by,
          content_title: content_title,
          content_text: content_text,
          no_flexible_button: cover_notice == :none

      - else
        - raise ArgumentError, content_by
