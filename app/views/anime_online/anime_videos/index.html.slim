= render layout: 'animes/page' do
  .video-player
    - if @player.current_video.hosting == 'myvi.ru' || (@player.current_video.hosting == 'sibnet.ru' && @player.current_video.url.include?('.swf?'))
      object
        param name="movie" value="#{@player.current_video.url}"
        param name="allowFullScreen" value="true"
        param name="allowScriptAccess" value="always"
        embed src="#{@player.current_video.player_url}" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always"
    - else
      iframe src="#{@player.current_video.player_url}"

  .cc
    .c-episodes
      .title Эпизоды
      - @player.videos.take(10).each do |(episode, videos)|
        .episode
          a class="#{:active if episode == @player.current_episode}" href="#{@player.episode_url episode}"
            span.episode-num = "##{episode.zero? ? 'прочее' : episode}"
            span.episode-kinds = @player.dropdown_kinds videos
            span.episode-hostings = @player.hostings videos
      - if @player.videos.size > 10
      .b-show_more + показать всё
      .b-show_more-more
        - @player.videos.to_a.slice(10,9999).each do |(episode, videos)|
          .episode
            a class="#{:active if episode == @player.current_episode}" href="#{@player.episode_url episode}"
              span.episode-num = "##{episode.zero? ? 'прочее' : episode}"
              span.episode-kinds = @player.dropdown_kinds videos
              span.episode-hostings = @player.hostings videos
        .hide-more
          | &mdash; спрятать

    .c-videos
      .title Варианты видео
      - @player.episode_videos.each do |video|
        .episode data-id="#{video.id}"
          a class="#{:active if video.id == @player.current_video.id}" href="#{play_video_online_index_url @player.anime.id, @player.current_episode, video.id}"
            span.video-kind = t ".kind.#{video.kind}"
            span.video-hosting = video.hosting
            - if video.author
              span.video-author = strip_tags video.author.name

  /.nav-video
    /ul.nav.nav-pills
      /li
        /.btn-group.episodes
          /a.btn.btn-default.btn-sm class="#{:disabled if @player.first_episode?}" href="#{@player.prev_url}" title="Предыдущий эпизод" &nbsp;<&nbsp;

          /.btn-group
            /button.btn.btn-default.btn-sm.dropdown-toggle data-toggle="dropdown" type="button"
              /= @player.episode_title
              /span.caret
            /ul.dropdown-menu
              /- @player.videos.each_pair do |episode, videos|
                /li class="#{:active if episode == @player.current_episode}"
                  /a href="#{@player.episode_url episode}"
                    /span.num = "##{episode.zero? ? 'прочее' : episode}"
                    /span.kinds = "#{@player.dropdown_kinds videos}"
                    /span.hostings = "/ #{@player.hostings videos}"

          /a.btn.btn-default.btn-sm class="#{:disabled if @player.last_episode?}" href="#{@player.next_url}" title="Следующий эпизод" &nbsp;>&nbsp;

      /- unless @player.current_videos.blank?
        /li
          /.btn-group.video
            /button.btn.btn-default.btn-sm.dropdown-toggle data-toggle="dropdown" type="button"
              /span.kind = t ".kind.#{@player.current_video.kind}"
              /span.hosting = @player.current_video.hosting
              /span.author = @player.current_author
              /span.caret
            /ul.dropdown-menu
              /- @player.episode_videos.each_with_index do |video, index|
                /li
                  /a href="#{play_video_online_index_url @player.anime.id, @player.current_episode, video.id}"
                    /span.kind = t ".kind.#{video.kind}"
                    /span.hosting = video.hosting
                    /- if video.author
                      /span.author = strip_tags video.author.name

        /- if user_signed_in? && @player.current_video.uploader == current_user && @player.current_video.created_at > 1.week.ago
          /li.pull-right
            /a.btn.btn-default.btn-sm href="#{delete_anime_videos_url @player.current_video.id}" data-method="delete" data-confirm="Вы точно хотить удалить это видео?" title='Удалить видео'
              /span.glyphicon.glyphicon-trash
        /- else
          /li.report.pull-right
            /.btn-group
              /button.btn.btn-default.btn-sm.dropdown-toggle data-toggle="dropdown" type="button" title='Пожаловаться на видео'
                /span.glyphicon.glyphicon-flag
                /span.caret
              /ul.dropdown-menu
                /li: a href="#{@player.report_url :broken}" data-remote="true" data-method="post" Видео не работает
                /li: a.wrong href="#" data-url="#{@player.report_url :wrong}" Видео не от этого аниме

        /- if user_signed_in?
          /li.pull-right
            /button.btn.btn-default.btn-sm data-href="#{edit_anime_online_anime_anime_video_url @player.anime.id, @player.current_video.id}" type='button' title='Редактировать видео'
              /span.glyphicon.glyphicon-pencil

          /- unless @player.current_video.copyright_ban?
            /li.pull-right
              /button.btn.btn-default.btn-sm data-href="#{new_anime_online_anime_anime_video_url @player.anime.id}" type='button' title='Загрузить новое видео'
                /span.glyphicon.glyphicon-upload

          /- unless @player.rate
            /li.rate.pull-right
              /a.btn.btn-default.btn-sm href="#{anime_online_rate_anime_url @player.anime.id}" title='Добавить в список к просмотру' data-remote="true" data-method="post"
                /span.glyphicon.glyphicon-plus

          /li.ok.pull-right class="#{'hide' unless @player.rate && @player.rate.episodes < @player.current_video.episode}"
            /a.btn.btn-success.btn-sm href="#{viewed_anime_online_anime_anime_video_url @player.anime.id, @player.current_video.id}" title='Просмотрено, перейти к следующему эпизоду'
              /span.glyphicon.glyphicon-ok
